\begin{algorithm}[H]
    \caption{\label{alg.multilevel-prover}The \textsf{Prove} algorithm
    for the multilevel NIPoPoW}
    \begin{algorithmic}[1]
        \Function{\sf patch-chain$_m$}{$\chain, \pi, \mu$}
            \Let{\pi'}{\pi}
            \For{$i = 0$\text{ to }$|\pi|$}
                \For{$j = i + m$\text{ to }$|\pi|$}
                    \Let{A}{\pi[i]}
                    \Let{Z}{\pi[j]}
                    \If{$|\pi[i:j]| = |\chain\{A:Z\}\upchain^\mu|$}
                        \If{$\lnot \textnormal{good}_{\delta, m}
                          (\chain, \pi[i:j], \mu)$}
                            \Let{\pi'}
                                {\pi' \cup \chain\{A:Z\}\upchain^{\mu - 1}}
                        \EndIf
                    \EndIf
                \EndFor
            \EndFor
            \State\Return{$\pi'$}
        \EndFunction
        \Function{\sf Prove$_{m,k,\delta}$}{$\chain$}
            \Let{B}{\chain[0]}
            \Comment{Genesis}
            \For{$\mu = |\chain[-k].\mathsf{interlink}|$ down to $0$}
                \Let{\alpha}{\chain[:-k]\{B:\}\upchain^\mu}
                \Let{\pi}{\pi \cup \alpha}
                % \If{$\textnormal{good}_{\delta, m}(\chain, \alpha, \mu)$}
                \Let{B}{\alpha[-m]}
                \Let{\pi}{\textsf{patch-chain}_m(\chain, \pi, \mu)}
                % \EndIf
            \EndFor
            \Let{\chi}{\chain[-k:]}
            \State\Return{$\pi\chi$}
        \EndFunction
    \vskip8pt
    \end{algorithmic}
\end{algorithm}
